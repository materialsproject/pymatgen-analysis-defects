Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/nbclient/client.py", line 1314, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/hostedtoolcache/Python/3.10.14/x64/lib/python3.10/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
from pymatgen.analysis.defects.generators import (
    ChargeInterstitialGenerator,
    generate_all_native_defects,
)
from pymatgen.io.vasp import Chgcar

chgcar = Chgcar.from_file(TEST_FILES / "CHGCAR.Fe3O4.vasp")
cig = ChargeInterstitialGenerator()
for defect in cig.generate(chgcar, insert_species=["H"]):
    print(defect)
------------------


[0;31m---------------------------------------------------------------------------[0m
[0;31mTypeError[0m                                 Traceback (most recent call last)
Cell [0;32mIn[10], line 9[0m
[1;32m      7[0m chgcar [38;5;241m=[39m Chgcar[38;5;241m.[39mfrom_file(TEST_FILES [38;5;241m/[39m [38;5;124m"[39m[38;5;124mCHGCAR.Fe3O4.vasp[39m[38;5;124m"[39m)
[1;32m      8[0m cig [38;5;241m=[39m ChargeInterstitialGenerator()
[0;32m----> 9[0m [38;5;28;01mfor[39;00m defect [38;5;129;01min[39;00m cig[38;5;241m.[39mgenerate(chgcar, insert_species[38;5;241m=[39m[[38;5;124m"[39m[38;5;124mH[39m[38;5;124m"[39m]):
[1;32m     10[0m     [38;5;28mprint[39m(defect)

File [0;32m~/work/pymatgen-analysis-defects/pymatgen-analysis-defects/pymatgen/analysis/defects/generators.py:491[0m, in [0;36mChargeInterstitialGenerator.generate[0;34m(self, chgcar, insert_species, **kwargs)[0m
[1;32m    489[0m     msg [38;5;241m=[39m [38;5;124m"[39m[38;5;124mInsert species must be unique.[39m[38;5;124m"[39m
[1;32m    490[0m     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(msg)
[0;32m--> 491[0m cand_sites_mul_and_equiv_fpos [38;5;241m=[39m [[38;5;241m*[39m[38;5;28mself[39m[38;5;241m.[39m_get_candidate_sites(chgcar)]
[1;32m    492[0m [38;5;28;01mfor[39;00m species [38;5;129;01min[39;00m insert_species:
[1;32m    493[0m     cand_sites, multiplicity, equiv_fpos [38;5;241m=[39m [38;5;28mzip[39m([38;5;241m*[39mcand_sites_mul_and_equiv_fpos)

File [0;32m~/work/pymatgen-analysis-defects/pymatgen-analysis-defects/pymatgen/analysis/defects/generators.py:516[0m, in [0;36mChargeInterstitialGenerator._get_candidate_sites[0;34m(self, chgcar)[0m
[1;32m    507[0m [38;5;28;01mdef[39;00m [38;5;21m_get_candidate_sites[39m([38;5;28mself[39m, chgcar: Chgcar) [38;5;241m-[39m[38;5;241m>[39m Generator[[38;5;28mtuple[39m, [38;5;28;01mNone[39;00m, [38;5;28;01mNone[39;00m]:
[1;32m    508[0m     cia [38;5;241m=[39m ChargeInsertionAnalyzer(
[1;32m    509[0m         chgcar,
[1;32m    510[0m         clustering_tol[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mclustering_tol,
[0;32m   (...)[0m
[1;32m    514[0m         min_dist[38;5;241m=[39m[38;5;28mself[39m[38;5;241m.[39mmin_dist,
[1;32m    515[0m     )
[0;32m--> 516[0m     avg_chg_groups [38;5;241m=[39m [43mcia[49m[38;5;241;43m.[39;49m[43mfilter_and_group[49m[43m([49m
[1;32m    517[0m [43m        [49m[43mavg_radius[49m[38;5;241;43m=[39;49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mavg_radius[49m[43m,[49m
[1;32m    518[0m [43m        [49m[43mmax_avg_charge[49m[38;5;241;43m=[39;49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mmax_avg_charge[49m[43m,[49m
[1;32m    519[0m [43m    [49m[43m)[49m
[1;32m    520[0m     [38;5;28;01mfor[39;00m _, g [38;5;129;01min[39;00m avg_chg_groups:
[1;32m    521[0m         [38;5;28;01myield[39;00m [38;5;28mmin[39m(g), [38;5;28mlen[39m(g), g

File [0;32m~/work/pymatgen-analysis-defects/pymatgen-analysis-defects/pymatgen/analysis/defects/utils.py:853[0m, in [0;36mChargeInsertionAnalyzer.filter_and_group[0;34m(self, avg_radius, max_avg_charge)[0m
[1;32m    851[0m avg_chg_first_member [38;5;241m=[39m {}
[1;32m    852[0m [38;5;28;01mfor[39;00m lab, g [38;5;129;01min[39;00m lab_groups[38;5;241m.[39mitems():
[0;32m--> 853[0m     avg_chg_first_member[lab] [38;5;241m=[39m [43mget_avg_chg[49m[43m([49m
[1;32m    854[0m [43m        [49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mchgcar[49m[43m,[49m
[1;32m    855[0m [43m        [49m[43mfcoord[49m[38;5;241;43m=[39;49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mlocal_minima[49m[43m[[49m[43mg[49m[43m[[49m[38;5;241;43m0[39;49m[43m][49m[43m][49m[43m,[49m
[1;32m    856[0m [43m        [49m[43mradius[49m[38;5;241;43m=[39;49m[43mavg_radius[49m[43m,[49m
[1;32m    857[0m [43m    [49m[43m)[49m
[1;32m    859[0m res [38;5;241m=[39m []
[1;32m    860[0m [38;5;28;01mfor[39;00m lab, avg_chg [38;5;129;01min[39;00m [38;5;28msorted[39m(avg_chg_first_member[38;5;241m.[39mitems(), key[38;5;241m=[39m[38;5;28;01mlambda[39;00m x: x[[38;5;241m1[39m]):

File [0;32m~/work/pymatgen-analysis-defects/pymatgen-analysis-defects/pymatgen/analysis/defects/utils.py:434[0m, in [0;36mget_avg_chg[0;34m(chgcar, fcoord, radius)[0m
[1;32m    432[0m     msg [38;5;241m=[39m [38;5;124m"[39m[38;5;124mf_coords must be in [0,1)[39m[38;5;124m"[39m
[1;32m    433[0m     [38;5;28;01mraise[39;00m [38;5;167;01mValueError[39;00m(msg)
[0;32m--> 434[0m mask [38;5;241m=[39m [43m_dist_mat[49m[43m([49m[43mfcoord[49m[43m)[49m [38;5;241m<[39m radius
[1;32m    435[0m vol_sphere [38;5;241m=[39m chgcar[38;5;241m.[39mstructure[38;5;241m.[39mvolume [38;5;241m*[39m (mask[38;5;241m.[39msum() [38;5;241m/[39m chgcar[38;5;241m.[39mngridpts)
[1;32m    436[0m [38;5;28;01mreturn[39;00m np[38;5;241m.[39msum(chgcar[38;5;241m.[39mdata[[38;5;124m"[39m[38;5;124mtotal[39m[38;5;124m"[39m] [38;5;241m*[39m mask) [38;5;241m/[39m mask[38;5;241m.[39msize [38;5;241m/[39m vol_sphere

File [0;32m~/work/pymatgen-analysis-defects/pymatgen-analysis-defects/pymatgen/analysis/defects/utils.py:425[0m, in [0;36mget_avg_chg.<locals>._dist_mat[0;34m(pos_frac)[0m
[1;32m    423[0m cc [38;5;241m=[39m np[38;5;241m.[39mlinspace([38;5;241m0[39m, [38;5;241m1[39m, [38;5;28mlen[39m(chgcar[38;5;241m.[39mget_axis_grid([38;5;241m2[39m)), endpoint[38;5;241m=[39m[38;5;28;01mFalse[39;00m)
[1;32m    424[0m AA, BB, CC [38;5;241m=[39m np[38;5;241m.[39mmeshgrid(aa, bb, cc, indexing[38;5;241m=[39m[38;5;124m"[39m[38;5;124mij[39m[38;5;124m"[39m)
[0;32m--> 425[0m dist_from_pos [38;5;241m=[39m [43mchgcar[49m[38;5;241;43m.[39;49m[43mstructure[49m[38;5;241;43m.[39;49m[43mlattice[49m[38;5;241;43m.[39;49m[43mget_all_distances[49m[43m([49m
[1;32m    426[0m [43m    [49m[43mfcoords1[49m[38;5;241;43m=[39;49m[43mnp[49m[38;5;241;43m.[39;49m[43mvstack[49m[43m([49m[43m[[49m[43mAA[49m[38;5;241;43m.[39;49m[43mflatten[49m[43m([49m[43m)[49m[43m,[49m[43m [49m[43mBB[49m[38;5;241;43m.[39;49m[43mflatten[49m[43m([49m[43m)[49m[43m,[49m[43m [49m[43mCC[49m[38;5;241;43m.[39;49m[43mflatten[49m[43m([49m[43m)[49m[43m][49m[43m)[49m[38;5;241;43m.[39;49m[43mT[49m[43m,[49m
[1;32m    427[0m [43m    [49m[43mfcoords2[49m[38;5;241;43m=[39;49m[43mpos_frac[49m[43m,[49m
[1;32m    428[0m [43m[49m[43m)[49m
[1;32m    429[0m [38;5;28;01mreturn[39;00m dist_from_pos[38;5;241m.[39mreshape(AA[38;5;241m.[39mshape)

[0;31mTypeError[0m: Lattice.get_all_distances() got an unexpected keyword argument 'fcoords1'

